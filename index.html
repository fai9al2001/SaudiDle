
<!DOCTYPE html>
<html lang="ar">
<head><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<meta charset="UTF-8">
<title>Saudile v7</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; margin:0; direction: rtl; }
#image-container { position: relative; display: inline-block; margin-top: 20px; }
#main-image { width: 95%; max-width: 1200px; border-radius: 8px; }
#map-thumb { position: absolute; bottom: 10px; right: 10px; width: 250px; height: 150px;
             border: 2px solid #ccc; border-radius: 4px; overflow: hidden; cursor: pointer; z-index: 10; transition: transform 0.3s ease; }
#map-thumb:hover { transform: scale(2); z-index: 11; }
#popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
         background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.3);
         z-index: 9999; display: none; max-width: 400px; text-align: right; }
#popup button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
.result-card { background: white; padding: 15px; margin-top: 20px; border-radius: 8px;
               box-shadow: 0 0 10px rgba(0,0,0,0.2); display: inline-block; text-align: center; }
.arrow { font-size: 1.5em; }
.quiz { background: white; padding: 15px; margin-top: 20px; border-radius: 8px; display: inline-block; }
.quiz h3 { margin-top: 0; }
.quiz button { margin: 5px; padding: 8px 12px; }
</style>
</head>
<body>

<h1>Saudile</h1>

<div id="image-container">
    <img id="main-image" src="assets/city_1.webp" alt="city image">
    <div id="map-thumb"></div>
</div>

<div id="popup">
    <h2>مرحبًا بك في Saudile</h2>
    <p>اختر أقرب مدينة في السعودية من خلال الخريطة والصور. لديك 5 محاولات.</p>
    <h3>معاني الإيموجي:</h3>
    <ul>
        <li>🔥 قريب جدًا (بين 11 و 100 كم)</li>
        <li>🟧 قريب نسبيًا (بين 101 و 199 كم)</li>
        <li>🟥 بعيد (+200 كم)</li>
    </ul>
    <button onclick="closePopup()">ابدأ</button>
</div>
<div id="confirm-message" style="margin-top:10px;"></div>

<div id="result"></div>
<div id="quiz"></div>


<script>


function showPopup() {
    document.getElementById("popup").style.display = "block";
}
function closePopup() {
    document.getElementById("popup").style.display = "none";
}
window.onload = function() {
    if(!localStorage.getItem("seenTutorial")){
        showPopup();
        localStorage.setItem("seenTutorial", "true");
    }
};

// Leaflet map setup
let map = L.map('map-thumb', { zoomControl: false, attributionControl: false }).setView([23.8859, 45.0792], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

map.on('click', function(e) {
    // Show custom confirmation message
    document.getElementById("confirm-message").innerHTML =
        `<div class="result-card">
            هل أنت متأكد من اختيار هذا الموقع؟
            <br>
            <button id="confirm-btn">تأكيد</button>
            <button id="cancel-btn">إلغاء</button>
        </div>`;
    // Confirm button
    document.getElementById("confirm-btn").onclick = function() {
        guessCityByCoords(e.latlng.lat, e.latlng.lng);
        document.getElementById("confirm-message").innerHTML = "";
    };
    // Cancel button
    document.getElementById("cancel-btn").onclick = function() {
        document.getElementById("confirm-message").innerHTML = "";
    };
});


function guessCityByCoords(lat, lng) {
    attempts++;
    // Change image after each attempt
    if (currentImage < images.length - 1) {
        currentImage++;
        document.getElementById("main-image").src = images[currentImage];
    }
    let dist = calcDistance(lat, lng, correctCoords[0], correctCoords[1]);
    let arrow = getDirectionArrow(lat, lng, correctCoords[0], correctCoords[1]);
    if(dist < 10){
        showResult(true, dist, arrow);
    } else if(attempts >= 5){
        showResult(false, dist, arrow);
    } else {
        showHint(dist, arrow);
    }
}

function calcDistance(lat1, lon1, lat2, lon2) {
    function toRad(v) { return v * Math.PI / 180; }
    let R = 6371; // km
    let dLat = toRad(lat2 - lat1);
    let dLon = toRad(lon2 - lon1);
    let a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function getDirectionArrow(lat1, lon1, lat2, lon2) {
    let dLat = lat2 - lat1;
    let dLon = lon2 - lon1;
    let angle = Math.atan2(dLon, dLat) * 180 / Math.PI;
    if(angle < 0) angle += 360;
    if(angle >= 337.5 || angle < 22.5) return "⬆️";
    if(angle >= 22.5 && angle < 67.5) return "↗️";
    if(angle >= 67.5 && angle < 112.5) return "➡️";
    if(angle >= 112.5 && angle < 157.5) return "↘️";
    if(angle >= 157.5 && angle < 202.5) return "⬇️";
    if(angle >= 202.5 && angle < 247.5) return "↙️";
    if(angle >= 247.5 && angle < 292.5) return "⬅️";
    return "↖️";
}

function getEmojiByDistance(dist) {
    if(dist <= 10) return "✅";
    if(dist >= 11 && dist <= 100) return "🔥";
    if(dist >= 101 && dist <= 199) return "🟧";
    return "🟥";
}

function showHint(dist, arrow) {
    document.getElementById("result").innerHTML = '<div class="result-card">'+getEmojiByDistance(dist)+' '+arrow+'</div>';
}

function showResult(win, dist, arrow) {
    if(win){
        document.getElementById("result").innerHTML = '<div class="result-card">أحسنت! 🎉<br>'+correctCity+'</div>';
        showQuiz();
    } else {
        document.getElementById("result").innerHTML = '<div class="result-card">انتهت المحاولات ❌<br>المدينة الصحيحة: '+correctCity+'</div>';
        showQuiz();
    }
}

function showQuiz(){
    let quizDiv = document.getElementById("quiz");
    let quizArr = selectedCity.quiz;
    let html = `<div class="quiz"><h3>حاب تختبر نفسك في ${correctCity}؟</h3>`;
    quizArr.forEach((q, idx) => {
        html += `<p>${q.question}</p>`;
        q.options.forEach(opt => {
            html += `<button class="quiz-btn" data-q="${idx}" data-opt="${opt}">${opt}</button>`;
        });
    });
    html += `</div>`;
    quizDiv.innerHTML = html;

    // Add event listeners
    document.querySelectorAll('.quiz-btn').forEach(btn => {
        btn.onclick = function() {
            let qIdx = parseInt(this.getAttribute('data-q'));
            let selected = this.getAttribute('data-opt');
            let correct = quizArr[qIdx].correct;
            if(selected === correct){
                this.style.background = "#c8e6c9"; // green
                this.innerText += " ✅";
            } else {
                this.style.background = "#ffcdd2"; // red
                this.innerText += " ❌";
            }
            // Disable all buttons for this question
            document.querySelectorAll(`.quiz-btn[data-q="${qIdx}"]`).forEach(b => b.disabled = true);
        };
    });
}
const cityData = [
    {
        name: "أبها",
        coords: [18.21639, 42.50528],
        images: [
            "assets/abha_1.webp",
            "assets/abha_2.webp",
            "assets/abha_3.webp",
            "assets/abha_4.webp",
            "assets/abha_5.webp"
        ],
        quiz: [
            {
                question: "كم يبلغ ارتفاع أبها عن سطح البحر؟",
                options: ["2200 متر", "1500 متر", "800 متر"],
                correct: "2200 متر"
            },
            {
                question: "ما اسم أشهر منتزه في أبها؟",
                options: ["منتزه السودة", "منتزه الملك عبدالعزيز", "منتزه عسير الوطني"],
                correct: "منتزه السودة"
            },
            {
                question: "ما هو لقب مدينة أبها؟",
                options: ["عروس الجبل", "مدينة الضباب", "مدينة الورد"],
                correct: "مدينة الضباب"
            }
        ]
    },
    {
        name: "الرياض",
        coords: [24.7136, 46.6753],
        images: [
            "assets/riyadh_1.webp",
            "assets/riyadh_2.webp",
            "assets/riyadh_3.webp",
            "assets/riyadh_4.webp",
            "assets/riyadh_5.webp"
        ],
        quiz: [
            {
                question: "كم عدد سكان الرياض؟",
                options: ["٥-٦ مليون", "٤-٥ مليون", "٣-٤ مليون"],
                correct: "٥-٦ مليون"
            },
            {
                question: "ما اسم أطول برج في الرياض؟",
                options: ["برج المملكة", "برج الفيصلية", "برج رافال"],
                correct: "برج المملكة"
            },
            {
                question: "ما هو رمز مدينة الرياض؟",
                options: ["النخلة", "البرج", "الجمل"],
                correct: "النخلة"
            }
        ]
    }
    // ... add more cities
];
const dateCityMap = {
    "2025-08-14": 0, // أبها
    "2025-08-15": 1, // الرياض
    // Add more dates and city indexes as needed
};
const today = new Date();
const todayStr = today.toISOString().slice(0, 10); // "YYYY-MM-DD"
const cityIndex = dateCityMap[todayStr] !== undefined ? dateCityMap[todayStr] : 0; // Default to أبها if not found
const selectedCity = cityData[cityIndex];

let images = selectedCity.images;
let currentImage = 0;
let correctCity = selectedCity.name;
let correctCoords = selectedCity.coords;
let attempts = 0;

// Set initial image
window.onload = function() {
    document.getElementById("main-image").src = images[0];
    if(!localStorage.getItem("seenTutorial")){
        showPopup();
        localStorage.setItem("seenTutorial", "true");
    }
};
</script>
</body>
</html>
