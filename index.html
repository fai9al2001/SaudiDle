
<!DOCTYPE html>
<html lang="ar">
<head><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SaudiDle v7</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; margin:0; direction: rtl; }
#image-container { position: relative; display: inline-block; margin-top: 20px; }
#main-image {
    width: 140vw;
    max-width: 880px;
    height: 457px;
    object-fit: cover;
    border-radius: 8px;
    margin-top: 20px;S
    display: block;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 0 10px #90caf9;
    transition: box-shadow 0.5s, transform 0.5s;
}
#map-thumb { position: absolute; bottom: 10px; right: 10px; width: 166px; height: 100px;
             border: 2px solid #ccc; border-radius: 4px; overflow: hidden; cursor: pointer; z-index: 10; transition: transform 0.3s ease; }
#map-thumb:hover { transform: scale(2); z-index: 11; }
#popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
         background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.3);
         z-index: 9999; display: none; max-width: 400px; text-align: right; }
#popup button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
.result-card { background: white; padding: 15px; margin-top: 20px; border-radius: 8px;
               box-shadow: 0 0 10px rgba(0,0,0,0.2); display: inline-block; text-align: center; }
.arrow { font-size: 1.5em; }
.quiz { background: white; padding: 15px; margin-top: 20px; border-radius: 8px; display: inline-block; }
.quiz h3 { margin-top: 0; }
.quiz button { margin: 5px; padding: 8px 12px; }
@media (max-width: 600px) {
    #image-container { width: 100%; }
    #main-image  {
    width: 60vw;
    max-width: 350px;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    margin-top: 20px;
    display: block;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 0 10px #90caf9;
    transition: box-shadow 0.5s, transform 0.5s;
}
    #map-thumb {
        position: static;
        width: 98vw;
        height: 180px;
        margin: 10px auto;
        display: block;
        transform: none !important;
    }
    .result-card, .quiz {
        width: 98vw;
        font-size: 1em;
        padding: 10px;
    }
    #popup {
        max-width: 95vw;
        padding: 10px;
    }
}
.quiz button, #popup button {
    font-size: 1.1em;
    padding: 12px 18px;
    min-width: 80px;
}
.result-card,
.quiz,
#popup,
#win-popup,
#settings-popup {
    background: #1F2023 !important;
    color: #D9D9D9 !important;
    border-radius: 32px !important; /* Unified roundness for all boxes */
    border: none !important;
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(40px);}
    to   { opacity: 1; transform: translateY(0);}
}
#main-image, #winner-image {
    transition: box-shadow 0.5s, transform 0.5s;
}
#main-image:hover, #winner-image:hover {
    box-shadow: 0 0 30px #90caf9;
    transform: scale(1.03);
}
.quiz button, #popup button, #stats-top-btn, #help-top-btn {
    transition: background 0.3s, transform 0.3s;
}
.quiz button:active, #popup button:active, #stats-top-btn:active, #help-top-btn:active {
    background: #e3f2fd;
    transform: scale(1.08);
}
body.dark-mode {
    background: #111 !important;
    color: #D9D9D9 !important;
}
body.dark-mode .result-card,
body.dark-mode .quiz,
body.dark-mode #popup,
body.dark-mode #win-popup,
body.dark-mode #settings-popup {
    background: #1F2023 !important;
    color: #D9D9D9 !important;
    border-radius: 32px !important; /* Unified roundness for all boxes */
    border: none !important;
}
body.dark-mode #main-image,
body.dark-mode #map-thumb {
    box-shadow: 0 0 20px #1F2023;
    border-color: #1F2023;
}
body.dark-mode button,
body.dark-mode .quiz button,
body.dark-mode #popup button,
body.dark-mode #win-popup button,
body.dark-mode #settings-popup button {
    background: #222 !important;
    color: #D9D9D9 !important;
    border: 1px solid #333 !important;
}
body.dark-mode #loading-bar {
    background: linear-gradient(90deg,#1B9E49,#222) !important;
}
button,
.quiz button,
#popup button,
#win-popup button,
#settings-popup button,
#hint-btn {
    font-size: 1.2em;
    padding: 14px 30px;
    margin-top: 20px;
    border-radius: 32px !important;
}
#stats-top-btn,
#help-top-btn,
#settings-top-btn {
    border-radius: 32px !important;
}
#top-buttons button {
    background: #222;
    color: #D9D9D9;
    border: none;
    padding: 8px 12px;
    margin-left: 6px;
    cursor: pointer;
    border-radius: 32px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: background 0.3s, transform 0.3s;
}
#top-buttons button:active {
    background: #333;
    transform: scale(1.08);
}
.fade-out {
    animation: fadeOut 0.3s forwards;
}
.fade-in {
    animation: fadeIn 0.4s;
}
@keyframes fadeOut {
    from { opacity: 1; }
    to   { opacity: 0; }
}
@keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
}
.fade-in {
    animation: fadeIn 0.4s;
}
.fade-out {
    animation: fadeOut 0.3s forwards;
}
@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95);}
    to   { opacity: 1; transform: scale(1);}
}
@keyframes fadeOut {
    from { opacity: 1; transform: scale(1);}
    to   { opacity: 0; transform: scale(0.95);}
}
#top-bar {
    width: 100%;
    background: #232323;
    color: #D9D9D9;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0;
    height: 56px;
    box-sizing: border-box;
    position: sticky;
    top: 0;
    z-index: 1001;
    border-bottom: 2px solid #444;
}

#site-title {
    flex: 1;
    text-align: center;
    font-size: 2em;
    font-weight: bold;
    color: #1B9E49;
    letter-spacing: 2px;
}

#top-buttons {
    display: flex;
    align-items: center;
    gap: 8px;
    height: 100%;
    margin-right: 0;
}

#top-buttons button {
    background: #232323;
    color: #D9D9D9;
    border: none;
    padding: 0;
    font-size: 1.5em;
    border-radius: 50%;
    cursor: pointer;
    height: 44px;
    width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 2px;
    transition: background 0.2s, color 0.2s;
    box-shadow: none;
}

#top-buttons button:active,
#top-buttons button:focus,
#top-buttons button:hover {
    background: #444;
    color: #fff;
}

@media (max-width: 600px) {
    #top-bar {
        height: 44px;
        padding: 0;
    }
    #site-title {
        font-size: 1.2em;
        padding: 0 4px;
    }
    #top-buttons button {
        font-size: 1em;
        height: 32px;
        width: 32px;
        margin: 0 1px;
    }
    #top-bar > div[style] {
        width: 96px !important;
    }
}
@media (max-width: 600px) {
    #image-container {
        width: 100%;
        position: relative;
    }
    #main-image  {
        width: 60vw;
        max-width: 350px;
        height: 180px;
        object-fit: cover;
        border-radius: 8px;
        margin-top: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 0 10px #90caf9;
        transition: box-shadow 0.5s, transform 0.5s;
    }
    #map-thumb {
        position: absolute;
        bottom: 12px;
        right: 12px;
        width: 90px;
        height: 60px;
        border-radius: 8px;
        z-index: 20;
        transition: all 0.3s cubic-bezier(.4,0,.2,1);
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
    }
    #map-thumb.expanded {
        width: 98vw;
        height: 220px;
        position: fixed;
        bottom: 50%;
        right: 50%;
        transform: translate(50%,50%) scale(1.05);
        border-radius: 18px;
        z-index: 1002;
        box-shadow: 0 0 30px #222;
    }
}
</style>
</head>
<body>
 <div id="top-bar">
  <div style="width:132px;"></div> <!-- Spacer: same width as buttons group -->
  <div id="site-title">SaudiDle</div>
  <div id="top-buttons">
    <button id="stats-top-btn" title="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">ğŸ“Š</button>
    <button id="help-top-btn" title="ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨">â“</button>
    <button id="settings-top-btn" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">âš™ï¸</button>
  </div>

</div>
  <!-- ...rest of your content... -->
</body>
  
</div>
<div id="image-container">
    <img id="main-image" src="assets/city_1.webp" alt="city image">
      <button id="close-map-btn" style="display:none;position:absolute;top:6px;left:6px;z-index:1003;">âœ–</button>
    <div id="map-thumb"></div>
</div>

<div id="popup">
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ SaudiDle</h2>
    <p>Ø­Ø§ÙˆÙ„ ØªØ®Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØµÙˆØ± ÙˆØ§Ø®ØªØ§Ø±Ù‡Ø§ Ø¨Ø§Ù„Ø®Ø±ÙŠØ·Ø© . Ù„Ø¯ÙŠÙƒ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙˆÙ…Ø¹ ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ù‡Ù†Ø§Ùƒ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©.</p>
    <h3>Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ:</h3>
    <ul>
        <li>ğŸ”¥ Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ù‹Ø§ (Ø¨ÙŠÙ† 11 Ùˆ 100 ÙƒÙ…)</li>
        <li>ğŸŸ§ Ù‚Ø±ÙŠØ¨ Ù†Ø³Ø¨ÙŠÙ‹Ø§ (Ø¨ÙŠÙ† 101 Ùˆ 199 ÙƒÙ…)</li>
        <li>ğŸŸ¥ Ø¨Ø¹ÙŠØ¯ (+200 ÙƒÙ…)</li>
    </ul>
    <button onclick="closePopup()">Ø§Ø¨Ø¯Ø£</button>
</div>
<div id="confirm-message" style="margin-top:10px;"></div>
<div id="settings-popup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
     background:#111; color:#1B9E49; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.3); z-index:99999; max-width:350px; width:90%; text-align:center; padding:20px;">
    <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
    <label style="font-size:1.2em;">
        <input type="checkbox" id="dark-mode-toggle" checked style="transform:scale(1.3);margin-left:8px;">
        ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ (Dark Mode)
    </label>
    <br>
    <button onclick="closeSettingsPopup()" style="margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
<div id="result"></div>
<div id="quiz"></div>

<button id="hint-btn" style="margin-top:25px;">ØªÙ„Ù…ÙŠØ­</button>
<div id="hint-message" style="margin-top:15px;"></div>
<div id="win-popup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
     background:white; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.3); z-index:99999; max-width:350px; width:90%; text-align:center; padding:20px;">
    <div id="win-tabs">
        <button id="tab-default" style="font-weight:bold;">Ù†ØªÙŠØ¬ØªÙƒ</button>
        <button id="tab-stats">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    </div>
    <div id="win-content-default">
        <h2>Ø£Ø­Ø³Ù†Øª!</h2>
        <p>Ø³Ù„Ø³Ù„ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="current-streak">0</span></p>
        <p>Ø£Ø¹Ù„Ù‰ Ø³Ù„Ø³Ù„Ø© Ø³Ø§Ø¨Ù‚Ø©: <span id="max-streak">0</span></p>
        <button id="share-btn">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>
    <div id="win-content-stats" style="display:none;">
        <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h3>
        <div id="horizontal-bar" style="margin:10px 0;"></div>
        <h3>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</h3>
        <div id="vertical-bar" style="height:120px; display:flex; align-items:flex-end; justify-content:center;"></div>
    </div>
    <button onclick="closeWinPopup()" style="margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
<div id="loading-bar-container" style="width:70%;max-width:700px;margin:20px auto 0 auto;display:none;">
    <div id="loading-bar" style="height:18px;background:#90caf9;border-radius:8px;width:0%;transition:width 1s;"></div>
</div>
<div id="gallery" style="display:none; margin: 30px auto; max-width: 900px;"></div>

<script>
    
document.getElementById("hint-btn").onclick = function() {
    const hintMsg = document.getElementById("hint-message");
    hintMsg.innerHTML =
        `<div class="result-card fade-in" style="margin-top:10px;">
            Ø§Ù„ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ‚Ø¹ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© <b>${selectedCity.province}</b>
        </div>`;
};
document.getElementById("stats-top-btn").onclick = function() {
    showWinPopup();
};
document.getElementById("help-top-btn").onclick = function() {
    showPopup();
};
function showPopup() {
    const popup = document.getElementById("popup");
    popup.classList.remove("fade-out");
    popup.style.display = "block";
    popup.classList.add("fade-in");
}
function closePopup() {
    const popup = document.getElementById("popup");
    popup.classList.remove("fade-in");
    popup.classList.add("fade-out");
    setTimeout(() => { popup.style.display = "none"; popup.classList.remove("fade-out"); }, 300);
}

function showWinPopup() {
    const winPopup = document.getElementById("win-popup");
    winPopup.classList.remove("fade-out");
    winPopup.style.display = "block";
    winPopup.classList.add("fade-in");
    // ...rest of your code...
}
function closeWinPopup() {
    const winPopup = document.getElementById("win-popup");
    winPopup.classList.remove("fade-in");
    winPopup.classList.add("fade-out");
    setTimeout(() => { winPopup.style.display = "none"; winPopup.classList.remove("fade-out"); }, 300);
}

function showSettingsPopup() {
    const settingsPopup = document.getElementById("settings-popup");
    settingsPopup.classList.remove("fade-out");
    settingsPopup.style.display = "block";
    settingsPopup.classList.add("fade-in");
}
function closeSettingsPopup() {
    const settingsPopup = document.getElementById("settings-popup");
    settingsPopup.classList.remove("fade-in");
    settingsPopup.classList.add("fade-out");
    setTimeout(() => { settingsPopup.style.display = "none"; settingsPopup.classList.remove("fade-out"); }, 300);
}
window.onload = function() {
    document.getElementById("main-image").src = images[0];
    showPopup(); // Always show the tutorial popup
};

// Leaflet map setup
let map = L.map('map-thumb', { zoomControl: false, attributionControl: false }).setView([23.8859, 45.0792], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

let userMarker; // Add this at the top of your script (outside any function)

map.on('click', function(e) {
    // Remove previous marker if exists
    if (userMarker) {
        map.removeLayer(userMarker);
    }
    // Add marker at clicked location
    userMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);

    document.getElementById("confirm-message").innerHTML =
        `<div class="result-card">
            Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØŸ
            <br>
            <button id="confirm-btn">ØªØ£ÙƒÙŠØ¯</button>
            <button id="cancel-btn">Ø¥Ù„ØºØ§Ø¡</button>
        </div>`;
    document.getElementById("confirm-btn").onclick = function() {
        guessCityByCoords(e.latlng.lat, e.latlng.lng);
        document.getElementById("confirm-message").innerHTML = "";
    };
    document.getElementById("cancel-btn").onclick = function() {
        document.getElementById("confirm-message").innerHTML = "";
    };
});

function guessCityByCoords(lat, lng) {
    attempts++;
    let dist = calcDistance(lat, lng, correctCoords[0], correctCoords[1]);
    let arrow = getDirectionArrow(lat, lng, correctCoords[0], correctCoords[1]);

    // Always show loading bar animation before feedback
    showLoadingBar(() => {
        if (dist < selectedCity.radius) {
    showResult(true, dist, arrow);
} else if (attempts >= 5) {
            showResult(false, dist, arrow);
        } else {
            showHint(dist, arrow);
            // Only now, after showing the result, change the image
            if (currentImage < images.length - 1) {
                currentImage++;
                document.getElementById("main-image").src = images[currentImage];
            }
        }
    });
}
function showLoadingBar(callback) {
    const loadingBarContainer = document.getElementById("loading-bar-container");
    const loadingBar = document.getElementById("loading-bar");
    loadingBarContainer.style.display = "block";
    loadingBar.style.width = "0%";
    loadingBar.style.background = "linear-gradient(90deg,#90caf9,#1976d2)";
    loadingBar.style.transition = "width 1s cubic-bezier(.4,0,.2,1)";
    setTimeout(() => {
        loadingBar.style.width = "100%";
    }, 50);
    setTimeout(() => {
        loadingBarContainer.style.display = "none";
        loadingBar.style.width = "0%";
        callback();
    }, 1100);
}
function calcDistance(lat1, lon1, lat2, lon2) {
    function toRad(v) { return v * Math.PI / 180; }
    let R = 6371;
    let dLat = toRad(lat2 - lat1);
    let dLon = toRad(lon2 - lon1);
    let a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function getDirectionArrow(lat1, lon1, lat2, lon2) {
    let dLat = lat2 - lat1;
    let dLon = lon2 - lon1;
    let angle = Math.atan2(dLon, dLat) * 180 / Math.PI;
    if(angle < 0) angle += 360;
    if(angle >= 337.5 || angle < 22.5) return "â¬†ï¸";
    if(angle >= 22.5 && angle < 67.5) return "â†—ï¸";
    if(angle >= 67.5 && angle < 112.5) return "â¡ï¸";
    if(angle >= 112.5 && angle < 157.5) return "â†˜ï¸";
    if(angle >= 157.5 && angle < 202.5) return "â¬‡ï¸";
    if(angle >= 202.5 && angle < 247.5) return "â†™ï¸";
    if(angle >= 247.5 && angle < 292.5) return "â¬…ï¸";
    return "â†–ï¸";
}

function getEmojiByDistance(dist) {
    if(dist <= 10) return "âœ…";
    if(dist >= 11 && dist <= 100) return "ğŸ”¥";
    if(dist >= 101 && dist <= 199) return "ğŸŸ§";
    return "ğŸŸ¥";
}

function showHint(dist, arrow) {
    let emoji = getEmojiByDistance(dist);
    let feedback = (dist < 10) ? "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!" : "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!";
    document.getElementById("result").innerHTML = `
        <div class="result-card" style="font-size:1.3em;">
            ${emoji} ${arrow}<br>
            <span>${feedback}</span>
        </div>
    `;
}

function showResult(win, dist, arrow) {
    if(win){
        document.getElementById("result").innerHTML = `
            <div class="result-card" style="background:#c8e6c9; color:#256029; font-size:1.5em; border:2px solid #388e3c;">
                âœ… Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ğŸ‰<br>${correctCity}
            </div>`;
        document.getElementById("map-thumb").style.display = "none";
        document.getElementById("main-image").style.display = "none";
        showQuiz();
        showWinPopup();
    } else {
        document.getElementById("result").innerHTML = `
            <div class="result-card" style="background:#ffcdd2; color:#b71c1c; font-size:1.5em; border:2px solid #b71c1c;">
                âŒ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©<br>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctCity}
            </div>`;
        showQuiz();
        showGallery(); // <-- Add this line here
    }
}

function showQuiz(){
    let quizDiv = document.getElementById("quiz");
    let quizArr = selectedCity.quiz;
    let html = `<div class="quiz"><h3>Ø­Ø§Ø¨ ØªØ®ØªØ¨Ø± Ù†ÙØ³Ùƒ ÙÙŠ ${correctCity}ØŸ</h3>`;
    quizArr.forEach((q, idx) => {
        html += `<p>${q.question}</p>`;
        q.options.forEach(opt => {
            html += `<button class="quiz-btn" data-q="${idx}" data-opt="${opt}">${opt}</button>`;
        });
    });
    html += `</div>`;
    quizDiv.innerHTML = html;

    document.querySelectorAll('.quiz-btn').forEach(btn => {
        btn.onclick = function() {
            let qIdx = parseInt(this.getAttribute('data-q'));
            let selected = this.getAttribute('data-opt');
            let correct = quizArr[qIdx].correct;
            if(selected === correct){
                this.style.background = "#c8e6c9";
                this.innerText += " âœ…";
                
            } else {
                this.style.background = "#ffcdd2";
                this.innerText += " âŒ";
                
            }
            document.querySelectorAll(`.quiz-btn[data-q="${qIdx}"]`).forEach(b => b.disabled = true);
        };
    });
}


function showWinPopup() {
    // Streak logic (localStorage)S
    let streak = Number(localStorage.getItem("currentStreak") || 0) + 1;
    let maxStreak = Math.max(streak, Number(localStorage.getItem("maxStreak") || 0));
    localStorage.setItem("currentStreak", streak);
    localStorage.setItem("maxStreak", maxStreak);
    document.getElementById("current-streak").textContent = streak;
    document.getElementById("max-streak").textContent = maxStreak;

    // Show popup
    document.getElementById("win-popup").style.display = "block";
    document.getElementById("win-content-default").style.display = "block";
    document.getElementById("win-content-stats").style.display = "none";
    document.getElementById("tab-default").style.fontWeight = "bold";
    document.getElementById("tab-stats").style.fontWeight = "normal";

    // Share button
    document.getElementById("share-btn").onclick = function() {
        let shareText = `SaudiDle\nØ§Ù„ÙŠÙˆÙ…: ${correctCity}\nØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${attempts}\nØ³Ù„Ø³Ù„ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${streak}\nØ£Ø¹Ù„Ù‰ Ø³Ù„Ø³Ù„Ø©: ${maxStreak}\nØ¬Ø±Ø¨ Ø¨Ù†ÙØ³Ùƒ: https://yourwebsite.com`;
        navigator.clipboard.writeText(shareText);
        this.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø®!";
        setTimeout(() => { this.textContent = "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©"; }, 1500);
    };

    // Tabs
   document.getElementById("tab-default").onclick = function() {
    const statsDiv = document.getElementById("win-content-stats");
    const defaultDiv = document.getElementById("win-content-default");
    statsDiv.classList.remove("fade-in");
    statsDiv.classList.add("fade-out");
    setTimeout(() => {
        statsDiv.style.display = "none";
        defaultDiv.style.display = "block";
        defaultDiv.classList.add("fade-in");
        document.getElementById("tab-default").style.fontWeight = "bold";
        document.getElementById("tab-stats").style.fontWeight = "normal";
        setTimeout(() => defaultDiv.classList.remove("fade-in"), 400);
        statsDiv.classList.remove("fade-out");
    }, 300);
};
document.getElementById("tab-stats").onclick = function() {
    const statsDiv = document.getElementById("win-content-stats");
    const defaultDiv = document.getElementById("win-content-default");
    defaultDiv.classList.remove("fade-in");
    defaultDiv.classList.add("fade-out");
    setTimeout(() => {
        defaultDiv.style.display = "none";
        statsDiv.style.display = "block";
        statsDiv.classList.add("fade-in");
        document.getElementById("tab-stats").style.fontWeight = "bold";
        document.getElementById("tab-default").style.fontWeight = "normal";
        renderStats();
        setTimeout(() => statsDiv.classList.remove("fade-in"), 400);
        defaultDiv.classList.remove("fade-out");
    }, 300);
};
}
function closeWinPopup() {
    document.getElementById("win-popup").style.display = "none";
    showGallery();
}

// Dummy stats for demo (replace with real stats if you have a backend)
function renderStats() {
    // Emojis for attempts
    const attemptEmojis = ["1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "4ï¸âƒ£", "5ï¸âƒ£"];
    let triesStats = JSON.parse(localStorage.getItem("triesStats") || "[0,0,0,0,0]");
    triesStats[attempts-1] = (triesStats[attempts-1] || 0) + 1;
    localStorage.setItem("triesStats", JSON.stringify(triesStats));
    let total = triesStats.reduce((a,b)=>a+b,0) || 1;

    // Horizontal bar
    let barHtml = `<div style="text-align:right; margin-bottom:10px;">Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ø§ÙŠØ§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</div>`;
    for(let i=0; i<5; i++) {
        let percent = Math.round(triesStats[i]/total*100);
        barHtml += `
        <div style="display:flex; align-items:center; margin-bottom:6px;">
            <span style="width:40px; font-size:1.5em;">${attemptEmojis[i]}</span>
            <div style="flex:1; background:#90caf9; height:22px; border-radius:4px; margin:0 8px; position:relative;">
                <div style="width:${percent}%; background:#1976d2; height:100%; border-radius:4px;"></div>
            </div>
            <span style="width:40px; font-size:0.95em;">${triesStats[i]} (${percent}%)</span>
        </div>`;
    }
    document.getElementById("horizontal-bar").innerHTML = barHtml;

    // Vertical bar
    let vBarHtml = `<div style="display:flex; align-items:flex-end; justify-content:center; height:100px;">`;
    for(let i=0; i<5; i++) {
        let percent = Math.round(triesStats[i]/total*100);
        vBarHtml += `
        <div style="margin:0 6px; text-align:center;">
            <div style="background:#a5d6a7; width:32px; height:${percent}px; border-radius:6px 6px 0 0; position:relative;">
                <span style="position:absolute;top:-24px;left:50%;transform:translateX(-50%);font-size:0.95em;">${percent}%</span>
            </div>
            <span style="font-size:1.5em;">${attemptEmojis[i]}</span>
        </div>`;
    }
    vBarHtml += `</div>`;
    document.getElementById("vertical-bar").innerHTML = vBarHtml;
}
const cityData = [
    {
        name: "Ø£Ø¨Ù‡Ø§",
        coords: [18.21639, 42.50528],
        province: "Ø¹Ø³ÙŠØ±",
         radius: 12,
        images: [
            "assets/abha_1.webp",
            "assets/abha_2.webp",
            "assets/abha_3.webp",
            "assets/abha_4.webp",
            "assets/abha_5.webp"
        ],
       imageDescriptions: [
           "Ø³Ø¯ Ø£Ø¨Ù‡Ø§ ÙŠÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø·Ø±Ù Ø§Ù„ØºØ±Ø¨ÙŠ Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ø¨Ù‡Ø§ ÙÙŠ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ ÙˆØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ Ø¹Ø§Ù… 1974",
            "Ø§Ù„Ù‚Ø±ÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙŠ Ø£Ø¨Ù‡Ø§: ØªÙ‚Ø¹ Ø§Ù„Ù‚Ø±ÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙŠ Ø£Ø¨Ù‡Ø§ Ø¹Ù„Ù‰ Ø­Ø§ÙØ© Ù…Ù†Ø­Ø¯Ø±Ø§Øª Ø¬Ø¨Ù„ Ø§Ù„Ø³Ø±ÙˆØ§Øª Ø§Ù„Ø´Ø§Ù‡Ù‚Ø©ØŒ ÙˆØªØªÙ…ÙŠØ² Ø¨Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ù…Ø°Ù‡Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¬Ø¨Ù„ÙŠØ© Ø§Ù„Ø®Ù„Ø§Ø¨Ø©",
            "Ù…Ù†ØªØ²Ù‡ Ø¹Ø³ÙŠØ± Ø§Ù„ÙˆØ·Ù†ÙŠ ÙÙŠ Ø£Ø¨Ù‡Ø§",
            "Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¬Ø§ÙƒØ±Ù†Ø¯Ø§ ÙÙŠ Ø´ÙˆØ§Ø±Ø¹ ÙˆÙ…Ù†ØªØ²Ù‡Ø§Øª Ù…Ø¯ÙŠÙ†Ø© Ø£Ø¨Ù‡Ø§ ØŒ Ø§Ù„ØªÙŠ ØªØªÙ…ÙŠØ² Ø¹Ù† Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø¨Ù„ÙˆÙ†Ù‡Ø§ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ Ø§Ù„Ø¬Ø°Ø§Ø¨",
            "Ù…Ù…Ø´Ù‰ Ø§Ù„Ø¶Ø¨Ø§Ø¨"
            ],
        quiz: [
            {
                question: "ÙƒÙ… ÙŠØ¨Ù„Øº Ø¹Ø¯Ø¯ Ø³ÙƒØ§Ù† Ù…Ø¯ÙŠÙ†Ø© Ø£Ø¨Ù‡Ø§ØŸ   ",
                options: ["Ø§Ù‚Ù„ Ù…Ù† 400 Ø§Ù„Ù Ù†Ø³Ù…Ø©", "Ø§ÙƒØ«Ø± Ù…Ù† 500 Ø§Ù„Ù Ù†Ø³Ù…Ø©", " 400 Ø§Ù„Ù -  500 Ø§Ù„Ù"],
                correct: " 400 Ø§Ù„Ù -  500 Ø§Ù„Ù"
            },
            
        ]
    },
    {
        name: "Ø§Ù„Ø±ÙŠØ§Ø¶",
        coords: [24.7136, 46.6753],
        province: "Ø§Ù„Ø±ÙŠØ§Ø¶",
         radius: 35,
        images: [
            "assets/riyadh_1.webp",
            "assets/riyadh_2.webp",
            "assets/riyadh_3.webp",
            "assets/riyadh_4.webp",
            "assets/riyadh_5.webp"
        ],
       imageDescriptions: [
            "Ø§Ù„Ø±ÙŠØ§Ø¶ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„",
            "Ø¨Ø±Ø¬ Ø§Ù„Ù…Ù…Ù„ÙƒØ©",
            "Ø§Ù„Ø­Ø¯Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶",
            "Ø´ÙˆØ§Ø±Ø¹ Ø§Ù„Ø±ÙŠØ§Ø¶",
            "ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶"
            ],
        quiz: [
            {
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø³ÙƒØ§Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ",
                options: ["Ù¥-Ù¦ Ù…Ù„ÙŠÙˆÙ†", "Ù¤-Ù¥ Ù…Ù„ÙŠÙˆÙ†", "Ù£-Ù¤ Ù…Ù„ÙŠÙˆÙ†"],
                correct: "Ù¥-Ù¦ Ù…Ù„ÙŠÙˆÙ†"
            },
            {
                question: "Ù…Ø§ Ø§Ø³Ù… Ø£Ø·ÙˆÙ„ Ø¨Ø±Ø¬ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ",
                options: ["Ø¨Ø±Ø¬ Ø§Ù„Ù…Ù…Ù„ÙƒØ©", "Ø¨Ø±Ø¬ Ø§Ù„ÙÙŠØµÙ„ÙŠØ©", "Ø¨Ø±Ø¬ Ø±Ø§ÙØ§Ù„"],
                correct: "Ø¨Ø±Ø¬ Ø§Ù„Ù…Ù…Ù„ÙƒØ©"
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø±Ù…Ø² Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ",
                options: ["Ø§Ù„Ù†Ø®Ù„Ø©", "Ø§Ù„Ø¨Ø±Ø¬", "Ø§Ù„Ø¬Ù…Ù„"],
                correct: "Ø§Ù„Ù†Ø®Ù„Ø©"
            }
        ]
    }
];

const dateCityMap = {
    "2025-08-14": 0,
    "2025-08-15": 1
};

const today = new Date();
const todayStr = today.toISOString().slice(0, 10);
const cityIndex = dateCityMap[todayStr] !== undefined ? dateCityMap[todayStr] : 0;
const selectedCity = cityData[cityIndex];

let images = selectedCity.images;
let currentImage = 0;
let correctCity = selectedCity.name;
let correctCoords = selectedCity.coords;
let attempts = 0;

// Set initial image

// Show settings popup
document.getElementById("settings-top-btn").onclick = function() {
    document.getElementById("settings-popup").style.display = "block";
};
// Close settings popup
function closeSettingsPopup() {
    document.getElementById("settings-popup").style.display = "none";
}
// Dark mode toggle
document.getElementById("dark-mode-toggle").onchange = function() {
    if(this.checked) {
        document.body.classList.add("dark-mode");
    } else {
        document.body.classList.remove("dark-mode");
    }
};
// Enable dark mode by default
document.body.classList.add("dark-mode");
document.getElementById("dark-mode-toggle").checked = true;
// ...all your functions above...

// Set initial image
window.onload = function() {
    document.getElementById("main-image").src = images[0];
    showPopup();
};

// Button event handlers (add at the end of your script)
document.getElementById("settings-top-btn").onclick = showSettingsPopup;
document.getElementById("help-top-btn").onclick = showPopup;
document.getElementById("stats-top-btn").onclick = showWinPopup;
function showGallery() {
    document.getElementById("image-container").style.display = "none";
    const galleryDiv = document.getElementById("gallery");
    let html = '<h2 style="color:#1B9E49;">ÙƒÙ„ Ø§Ù„ØµÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</h2><div style="display:flex;flex-wrap:wrap;justify-content:center;gap:24px;">';

    // Use the descriptions from the selected city
    const imageDescriptions = selectedCity.imageDescriptions;

    images.forEach((imgSrc, idx) => {
        html += `
        <div style="background:#1F2023;padding:16px;border-radius:32px;width:320px;box-sizing:border-box;">
    <img src="${imgSrc}" style="width:100%;height:200px;object-fit:cover;border-radius:18px;box-shadow:0 0 12px #222;">
            <div style="margin-top:8px;color:#D9D9D9;font-size:0.95em;">
                ${imageDescriptions[idx] || `ØµÙˆØ±Ø© Ø±Ù‚Ù… ${idx+1}`}
            </div>
        </div>`;
    });

    html += '</div>';
    galleryDiv.innerHTML = html;
    galleryDiv.style.display = "block";
}
function closeWinPopup() {
    document.getElementById("win-popup").style.display = "none";
    showGallery();
}
document.getElementById("map-thumb").onclick = function(e) {
    // Only expand if not already expanded
    if (!this.classList.contains("expanded")) {
        this.classList.add("expanded");
    } else {
        this.classList.remove("expanded");
    }
    // Prevent map click from triggering quiz/map logic
    e.stopPropagation();
};
const mapThumb = document.getElementById("map-thumb");
const closeMapBtn = document.getElementById("close-map-btn");

mapThumb.onclick = function(e) {
    if (!mapThumb.classList.contains("expanded")) {
        mapThumb.classList.add("expanded");
        closeMapBtn.style.display = "block";
    }
    e.stopPropagation();
};

closeMapBtn.onclick = function(e) {
    mapThumb.classList.remove("expanded");
    closeMapBtn.style.display = "none";
    e.stopPropagation();
};
</script>
</body>
</html>